---
layout:     post
title:      "小程序、RN、Weex对比与思考"
subtitle:   "小程序、RN、Weex对比，新工程技术选型"
date:        2017-04-17 09:00:00
author:     ""
header-img: "img/rn_bg.jpg"
tags:
   - rn weex 小程序 android ios 跨平台
---

小程序、RN、Weex对比与思考
======
### 本文主要包含以下内容
>* 小程序、RN、Weex 三个方案的实现原理？
* 如何在 RN 和 Weex 之间做选择？
* 如何将跨端开发工程化，需要做些什么事情？
* 如何在公司内推广跨端方案？
* 小程序、RN、Weex 与传统开发（Native，H5）的优劣？

## 小程序、RN、Weex 三个方案的实现原理？
> **ReactNative、Weex、小程序的开发的核心理念没有太大的区别，都是顶层JS Code，构建JS Bundle代码，通过JS引擎渲染虚拟DOM树，虚拟DOM树通过bridge转化为Native的UI。**

> *核心思路基本都是如此，只是在上层的开发框架一个是JSX，另一个是Vue，引擎Weex使用了V8 engine代替了JScore。*

> **小程序是Native和WebView结合的方式**，很多都是通过WebView加载的html，native部分也会有一些组件，比如tab这种对渲染要求比较高的。但是操作起来流畅度和native不相上下是很神奇的一件事，这主要是基于腾讯非常强大的架构团队深度优化的WebView缓存机制，基本能做到秒加载。小程序其实更高级一些，因为通过bridge之后还将js转化成了h5页面，通过webview来渲染，他把他h5影响体验的部分都做了架构分流，比如头尾，tab这种，底层使用了原生。

### 如何在 RN 和 Weex 之间做选择？
* Weex优势在于，我们的前端基本是使用Vue，使用Weex可以与公司的技术栈保持一致，而且Weex在不同平台上用法的特性更少，基本同一个API在Android和IOS上都会支持，并不存在太多的像RN那种，很多API只能在某一个平台使用的情况。而且Weex是支持跨三端的语言，但是其实Web端也不会特别理想。
* 但是Weex的劣势也很明显，Weex既然是阿里系的项目，其实它瞄准的场景是偏营销的业务，与重交互的复杂应用形态不相符，第三方组件很少，而且关注到Weex的社区，确实人丁稀少到可怜。
* React Native相比较Weex，缺点在于暂未支持拆包，以至于ReactNative的加载速度很慢，而JSBundle拆包的具体方案在RN还不是特别成熟。
* 但是ReactNative的优点很多，虽然Weex声称轻量级、渲染速度更快，但是其实使用起来会发现RN的引擎并不比Weex慢多少，大部分公司的业务并不会像阿里的业务一样偏展示营销，还是有一些重度交互与复杂业务处理。而对于ReactNative虽然不支持跨三端，但是前端来说，使用React.js或者Vue.js上手并不是很难，而且最主要的是，RN的社区非常活跃。

## RN工程化体系？
> **首先我们在开启一个RN的项目的时候一定要考虑，如何正式搭建一个ReactNative的工程化项目。**
> 
> 首先要定义项目目标，我们要求使用RN来落实多少移动端的业务，刨除本身RN的限制，我们希望落地70%的业务，首先人员的配置是以客户端为主。
> 
> ### 工程化构成
> #### RN部分
> 脚手架搭建，并开发一个项目的模板和一个标准示例，大部分Native的开发者对js的理解不是很深，尽量让整个团队开发的代码一致，尤其是JS的开发，很容易越来越乱。及时Review代码，整理一套标准化模板。
> 
> #### 开发框架的搭建
> *主要是限制*
> 
>* 限制项目分层
* 自动管理route
* 限制数据管理方式
* 限制视图栈管理方式

> #### Native部分
>* 协议互调：Native可以用协议调起任何RN业务，RN也可以调用起来Native原有的业务，并且能进入其中某个页面并传入参数。native的功能通过协议调起RN的模块，这个协议要简单化，类似于h5，通过一个uri或者一个hash就可以调起来。
* 组件：主要是一些RN的实现盲区，我们需要用Native进行封装，并提供接口。
* 集成：插件化，Native作容器，Native工程打包时本地集成bundle过程，Native和RN包版本依赖的管理，在线更新机制。
* 调试：直连本地RN服务调试。

> #### 性能/监控
* 秒开问题，Bundle过大如何保证首次加载速度。
* Crash监控，Native和RN的监控如何保证。
* 埋点监控，检测用户操作热点。

##小程序、RN、Weex与传统Native、H5的优劣

###相对于Native
* 开发调试方便
* 跨平台，从方案到框架到组件都只需要一套，人力消耗。
* 缺点：性能盲点，复杂的动画或者组件无法搞定。需要完善的架构团队，否则不管是前端还是客户端都很难完全hold住。

###相对于H5
* UI体验好。
* 生态稳定单一，在兼容、性能方面都比H5更加专注。
* 缺点：开发效率、调试还是无法比肩H5，H5在组件成熟度无与伦比。
* **但是如果业务简单，为什么不用H5呢，H5可能不仅跨平台，还会跨到微信。H5的开发效率调试更加成熟。**














